# eapli.framework build configuration for Java (Maven)
# Check our guides at https://confluence.atlassian.com/x/zd-5Mw for more examples.
# Only use spaces to indent your .yml configuration.
# -----
image: maven:3.6.3-jdk-11

pipelines:
  default:
    # build & QA
    - step:
        caches:
          - maven
        script: 
          - mvn -B verify -Dmaven.test.failure.ignore=true -Dmaven.javadoc.skip=true
    - step:
        trigger: manual
        caches:
          - maven
        script: 
          - mvn -B org.jacoco:jacoco-maven-plugin:prepare-agent verify org.jacoco:jacoco-maven-plugin:report -Dmaven.test.failure.ignore=true -Dmaven.javadoc.skip=true
          - mvn -B sonar:sonar -Dsonar.projectKey=pag_isep_eapli.framework -Dsonar.organization=pag_isep-bitbucket -Dsonar.host.url=https://sonarcloud.io -Dsonar.login=$SONAR_PASS -Dmaven.javadoc.skip=true
    - step:
        trigger: manual
        caches:
          - maven
        script: 
          - apt-get update && apt-get install -y graphviz 
          - mvn -B site

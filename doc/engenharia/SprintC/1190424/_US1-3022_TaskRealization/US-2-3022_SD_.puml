@startuml
autonumber

 actor "User" as U
participant ":AccomplishPendingTaskUI" as UI
participant ":AccomplishPendingTaskController" as CTRL
participant ":AuthzRegistry" as AR
participant "authz\n:AuthorizationService" as AS
participant ":CollaboradorRepository" as CR
participant ":TaskRepository" as TR
participant ":Task" as T

activate U
U-> UI : Iniciates the request to accomplish a task
activate UI
activate CTRL
         UI-> CTRL** : create()
         ref over CTRL
         US-1-2051_SD_Repo
         end ref
         deactivate CTRL



           deactivate CTRL

                  UI-> CTRL : getPendingTasks()
                  activate CTRL

                  CTRL-> TR : getPendingTasks(username)
                  activate TR

                  TR--> CTRL : pendingTasks
                  deactivate TR

                  CTRL-> CR : findByUserName(username)
                  activate CR
                  CR--> CTRL : collab
                  deactivate CR

                  CTRL--> UI : pendingTasks
                  deactivate CTRL




UI -> UI : doShow()
UI --> U: show pending tasks
U-> UI : choose task to accomplish
opt
UI -> CTRL : pendingTaskApproval(username)
CTRL -> CR : colaborador=findByUsername(username)
activate CR
deactivate CR
CTRL -> TR : find pendingTaskApprovalCollaborador(Colaborador)
activate TR
deactivate TR
CTRL -> UI : Tasks
UI -> CTRL : accomplishPendingTaskApproval(Tarefa, dadosFormulario, isTarefaAprovada)
CTRL -> T : validarDadosFormulario(dadosFormulario)
activate T
deactivate T
CTRL -> T : atualizarDadosFormulario(dadosFormulario)
activate T
deactivate T
opt
CTRL -> CTRL : criarTarefasFluxoValido(Tarefa)
note left : isTarefaAprovada : true
CTRL -> T : alterarEstadoTarefa(FINALIZADA)
activate T
deactivate T
end opt
opt
CTRL -> CTRL : criarTarefasFluxoInvalido(Tarefa)
note left : isTarefaAprovada : false
CTRL -> T : alterarEstadoTarefa(REJEITADA)
activate T
deactivate T
end opt
CTRL -> TR : save(Tarefa)
activate TR
deactivate TR
end opt
opt
UI -> CTRL : realizarTarefaResolucaoPendente(Tarefa, dadosFormulario)
UI -> CTRL : tarefasResolucaoPendentes(username)
CTRL -> CR : colaborador=findByUsername(username)
activate CR
deactivate CR
CTRL -> TR : findTarefasResolucaoPendentesColaborador(Colaborador)
activate TR
deactivate TR
CTRL -> UI : Tarefas
CTRL -> T : validarDadosFormulario(dadosFormulario)
activate T
deactivate T
CTRL -> T : atualizarDadosFormulario(dadosFormulario)
activate T
deactivate T
CTRL -> T : alterarEstadoTarefa(FINALIZADA)
activate T
deactivate T
CTRL -> TR : save(Tarefa)
activate TR
deactivate TR
end opt
deactivate CTRL
deactivate UI

@enduml